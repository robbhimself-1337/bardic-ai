{% extends "character/base_wizard.html" %}

{% block title %}Step 4: Ability Scores{% endblock %}

{% block extra_css %}
<style>
    .step-header { text-align: center; margin-bottom: 30px; }
    .step-header h2 { color: #d4af37; font-size: 2em; margin-bottom: 10px; }
    .method-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        justify-content: center;
    }
    .tab-btn {
        padding: 12px 30px;
        background: transparent;
        border: 2px solid #d4af37;
        color: #d4af37;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }
    .tab-btn.active {
        background: #d4af37;
        color: #2c1810;
    }
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }
    .abilities-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    .ability-box {
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid #8b7355;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
    }
    .ability-name {
        color: #d4af37;
        font-weight: bold;
        margin-bottom: 10px;
        font-size: 1.1em;
    }
    .ability-score {
        font-size: 2.5em;
        color: #90ee90;
        margin: 10px 0;
    }
    .ability-modifier {
        font-size: 1.5em;
        color: #f4d03f;
    }
    .ability-input {
        width: 80px;
        padding: 8px;
        font-size: 1.5em;
        text-align: center;
        background: rgba(0, 0, 0, 0.5);
        border: 2px solid #d4af37;
        border-radius: 5px;
        color: #90ee90;
    }
    .standard-array {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .array-value {
        padding: 15px 25px;
        background: #d4af37;
        color: #2c1810;
        font-size: 1.5em;
        font-weight: bold;
        border-radius: 8px;
        cursor: grab;
    }
    .roll-section {
        text-align: center;
    }
    .roll-btn {
        padding: 15px 40px;
        font-size: 1.3em;
        background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
        border: none;
        border-radius: 10px;
        color: #2c1810;
        font-weight: bold;
        cursor: pointer;
        margin: 20px 0;
    }
    .roll-result {
        font-size: 1.2em;
        color: #90ee90;
        margin: 10px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="step-header">
    <h2>Determine Ability Scores</h2>
    <p>Choose how to generate your character's six ability scores</p>
</div>

<div class="method-tabs">
    <button class="tab-btn active" onclick="showTab('standard')">Standard Array</button>
    <button class="tab-btn" onclick="showTab('pointbuy')">Point Buy</button>
    <button class="tab-btn" onclick="showTab('roll')">Roll Dice</button>
</div>

<div id="standard" class="tab-content active">
    <p style="text-align: center; color: #c0b090; margin-bottom: 20px;">
        Assign these values to your abilities: <strong>15, 14, 13, 12, 10, 8</strong>
    </p>
    <div class="abilities-grid">
        <div class="ability-box">
            <div class="ability-name">Strength</div>
            <select class="ability-input" id="str" onchange="updateModifiers()">
                <option value="">-</option>
                <option value="15">15</option>
                <option value="14">14</option>
                <option value="13">13</option>
                <option value="12">12</option>
                <option value="10">10</option>
                <option value="8">8</option>
            </select>
            <div class="ability-modifier" id="str-mod">+0</div>
        </div>
        <div class="ability-box">
            <div class="ability-name">Dexterity</div>
            <select class="ability-input" id="dex" onchange="updateModifiers()">
                <option value="">-</option>
                <option value="15">15</option>
                <option value="14">14</option>
                <option value="13">13</option>
                <option value="12">12</option>
                <option value="10">10</option>
                <option value="8">8</option>
            </select>
            <div class="ability-modifier" id="dex-mod">+0</div>
        </div>
        <div class="ability-box">
            <div class="ability-name">Constitution</div>
            <select class="ability-input" id="con" onchange="updateModifiers()">
                <option value="">-</option>
                <option value="15">15</option>
                <option value="14">14</option>
                <option value="13">13</option>
                <option value="12">12</option>
                <option value="10">10</option>
                <option value="8">8</option>
            </select>
            <div class="ability-modifier" id="con-mod">+0</div>
        </div>
        <div class="ability-box">
            <div class="ability-name">Intelligence</div>
            <select class="ability-input" id="int" onchange="updateModifiers()">
                <option value="">-</option>
                <option value="15">15</option>
                <option value="14">14</option>
                <option value="13">13</option>
                <option value="12">12</option>
                <option value="10">10</option>
                <option value="8">8</option>
            </select>
            <div class="ability-modifier" id="int-mod">+0</div>
        </div>
        <div class="ability-box">
            <div class="ability-name">Wisdom</div>
            <select class="ability-input" id="wis" onchange="updateModifiers()">
                <option value="">-</option>
                <option value="15">15</option>
                <option value="14">14</option>
                <option value="13">13</option>
                <option value="12">12</option>
                <option value="10">10</option>
                <option value="8">8</option>
            </select>
            <div class="ability-modifier" id="wis-mod">+0</div>
        </div>
        <div class="ability-box">
            <div class="ability-name">Charisma</div>
            <select class="ability-input" id="cha" onchange="updateModifiers()">
                <option value="">-</option>
                <option value="15">15</option>
                <option value="14">14</option>
                <option value="13">13</option>
                <option value="12">12</option>
                <option value="10">10</option>
                <option value="8">8</option>
            </select>
            <div class="ability-modifier" id="cha-mod">+0</div>
        </div>
    </div>
</div>

<div id="pointbuy" class="tab-content">
    <p style="text-align: center; color: #c0b090; margin-bottom: 20px;">
        Points Remaining: <span id="pointsLeft" style="color: #d4af37; font-weight: bold;">27</span>
    </p>
    <p style="text-align: center; color: #c0b090; margin-bottom: 20px; font-size: 0.9em;">
        (Costs: 8=0, 9=1, 10=2, 11=3, 12=4, 13=5, 14=7, 15=9)
    </p>
    <div class="abilities-grid">
        <div class="ability-box">
            <div class="ability-name">Strength</div>
            <input type="number" class="ability-input" id="pb-str" min="8" max="15" value="8" onchange="updatePointBuy()">
            <div class="ability-modifier" id="pb-str-mod">-1</div>
        </div>
        <!-- Similar for other abilities -->
    </div>
</div>

<div id="roll" class="tab-content">
    <div class="roll-section">
        <p style="color: #c0b090; margin-bottom: 20px;">Roll 4d6, drop the lowest die, six times</p>
        <button class="roll-btn" onclick="rollAbilities()">üé≤ Roll All Abilities üé≤</button>
        <div id="rollResults"></div>
    </div>
</div>

<form method="POST" id="abilitiesForm">
    <input type="hidden" name="strength" id="final-str">
    <input type="hidden" name="dexterity" id="final-dex">
    <input type="hidden" name="constitution" id="final-con">
    <input type="hidden" name="intelligence" id="final-int">
    <input type="hidden" name="wisdom" id="final-wis">
    <input type="hidden" name="charisma" id="final-cha">
    <div class="navigation">
        <a href="/character/step2" class="btn btn-secondary">‚Üê Back</a>
        <button type="submit" class="btn btn-primary" id="nextBtn">Next: Background ‚Üí</button>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
    function showTab(tabName) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        event.target.classList.add('active');
        document.getElementById(tabName).classList.add('active');
    }

    function updateModifiers() {
        ['str', 'dex', 'con', 'int', 'wis', 'cha'].forEach(ability => {
            const score = parseInt(document.getElementById(ability).value) || 10;
            const modifier = Math.floor((score - 10) / 2);
            document.getElementById(ability + '-mod').textContent = modifier >= 0 ? '+' + modifier : modifier;
            document.getElementById('final-' + ability).value = score;
        });
    }

    function rollAbilities() {
        const results = [];
        for (let i = 0; i < 6; i++) {
            const rolls = [
                Math.floor(Math.random() * 6) + 1,
                Math.floor(Math.random() * 6) + 1,
                Math.floor(Math.random() * 6) + 1,
                Math.floor(Math.random() * 6) + 1
            ].sort((a, b) => b - a);
            const total = rolls[0] + rolls[1] + rolls[2];
            results.push(total);
        }

        document.getElementById('rollResults').innerHTML = `
            <div class="roll-result">Your rolls: ${results.join(', ')}</div>
            <p style="color: #c0b090; margin-top: 20px;">Assign these values to your abilities in the order you prefer</p>
        `;
    }
</script>
{% endblock %}
